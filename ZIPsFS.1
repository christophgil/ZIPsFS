'\" t
.\" Automatically generated by Pandoc 2.17.1.1
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "ZIPsFS" "1" "" "" ""
.hy
.SH NAME
.PP
\f[B]ZIPsFS\f[R] - FUSE-based overlay union file system expanding ZIP
files
.SH Example usage
.IP
.nf
\f[C]
ZIPsFS [ZIPsFS-options] path-of-branch1/  branch2/  branch3/  branch4/  :  [fuse-options] mount-point
\f[R]
.fi
.SH Summary
.PP
ZIPsFS functions as a \f[B]union or overlay\f[R] file system, merging
multiple file structures into a unified directory.
This directory presents the underlying files and sub-directories from
the specified sources (branches) as a single, cohesive structure.
Any newly created or modified files are stored in the first file
location, while all other sources remain read-only, ensuring that their
files are never altered.
ZIPsFS treats \f[B]ZIP files as expandable folders\f[R], typically
naming them by appending \f[V].Contents/\f[R] to the original ZIP file
name.
However, this behavior can be customized using filename-based rules.
Extensive configuration options allow adjustments.
Changes can be applied without disrupting the file system.
.PP
With a trailing slash, the folder name is not part of the virtual path,
in accordance with the trailing slash semantics of many UNIX tools.
.PP
ZIPsFS includes specialized features like \f[B]automatic file
conversions\f[R] and performance optimizations tailored for efficiently
storing and accessing \f[B]large-scale mass spectrometry\f[R] data.
It manages non-sequential file reading from varying positions (so-called
file seek) efficiently to improve reading of remote and zipped files.
It has a programming interface to create synthetic file content
programmatically.
.PP
ZIPsFS is best run in a \f[B]tmux\f[R] session.
.SH Mini tutorial
.PP
Please Install ZIPsFS.
.SS Create some example files
.PP
Without trailing slash, the folder name will be retained in the virtual
path.
This is the case for \f[V]branch3\f[R].
Virtual file paths in that branch will start with \f[I]mount
point\f[R]\f[V]/branch3/\f[R].
.IP
.nf
\f[C]
b1=\[ti]/test/ZIPsFS/writable/
b2=\[ti]/test/ZIPsFS/branch1/
b3=\[ti]/test/ZIPsFS/branch2/
b4=\[ti]/test/ZIPsFS/branch3

mkdir -p $b1 $b2 $b3 $b4 \[ti]/test/ZIPsFS/mnt

for c in a b c d e f; do echo hello world $c >$b2/$c.txt; done
for ((i=0;i<10;i++)); do echo hello world $i >$b3/$i.txt; done

zip --fifo $b2/zipfile1.zip <(date)  <(echo $RANDOM)
zip --fifo $b3/zipfile2.zip <(hostname)  <(ls /)
zip --fifo $b3/20250131_this_is_a_mass_spectrometry_folder.d.Zip   <(seq 10)
\f[R]
.fi
.SS Start ZIPsFS
.PP
In production, it is recommended to start ZIPsFS in \f[I]tmux\f[R].
For testing, just use your regular command line.
.IP
.nf
\f[C]
ZIPsFS   $b1 $b2 $b3 $b4  :  \[ti]/test/ZIPsFS/mnt
\f[R]
.fi
.SS Browse the virtual file tree
.PP
Open a file browser or another terminal and browse the files in
.IP
.nf
\f[C]
\[ti]/test/ZIPsFS/mnt/
\f[R]
.fi
.SS Create a file in the virtual tree
.PP
The first file tree stores files.
All others are read-only.
.IP
.nf
\f[C]
echo \[dq]Hello\[dq] > \[ti]/test/ZIPsFS/mnt/my_file.txt

cat \[ti]/test/ZIPsFS/mnt/my_file.txt
\f[R]
.fi
.PP
To get the real storage place of the file, append
\f[V]\[at]SOURCE.TXT\f[R]
.IP
.nf
\f[C]
cat \[ti]/test/ZIPsFS/mnt/my_file.txt\[at]SOURCE.TXT
\f[R]
.fi
.SS Access web resources as regular files
.PP
Make sure the UNIX tool curl is installed.
.IP
.nf
\f[C]
curl --version
\f[R]
.fi
.PP
Note that \[lq]//:\[rq] and all slashes in the URL are replaced by
commas.
.IP
.nf
\f[C]
less  \[ti]/test/ZIPsFS/mnt/ZIPsFS/n/ftp,,,ftp.uniprot.org,pub,databases,uniprot,LICENSE
\f[R]
.fi
Decompress on download
.PP
With the virtual folder \f[V]/ZIPsFS/n/gz\f[R], a gz file is download
and decompressed.
In the following case the URL is
https://files.rcsb.org/download/1SBT.pdb.gz.
Not that \f[V].gz\f[R] is appended to the URL.
.IP
.nf
\f[C]
head  \[ti]/test/ZIPsFS/mnt/ZIPsFS/n/gz/https,,,files.rcsb.org,download,1SBT.pdb
\f[R]
.fi
.PP
To download without decompression, just use the default folder
\f[V]/ZIPsFS/n/\f[R].
.IP
.nf
\f[C]
gunzip -c  \[ti]/test/ZIPsFS/mnt/ZIPsFS/n/https,,,files.rcsb.org,download,1SBT.pdb.gz
\f[R]
.fi
.PP
Here, the HTTP header does not have a \f[V]Content-Length\f[R] field.
Bevore the file is downloaded, its file size is not known.
ZIPsFS will display a wrong file size which might be a problem for some
software.
.SH DESCRIPTION
.SS ZIPsFS is a Union / overlay file system
.PP
ZIPsFS functions as a union (overlay) file system.
When files are created or modified, they are stored in the first file
tree.
If a file exists in multiple source locations, the version from the
leftmost source (the first one listed) takes precedence.
With an empty string as the first source, the ZIPsFS file system
read-only and file creation and modification is disabled.
.PP
The physical file path, i.e., the actual storage location of a file, can
be retrieved from a file formed by appending \f[V]\[at]SOURCE.TXT\f[R]
to the filename.
For example, to determine the real location of:
\f[V]\[ti]/test/ZIPsFS/mnt/1.txt\f[R] Run the following command:
.IP
.nf
\f[C]
cat \[ti]/test/ZIPsFS/mnt/1.txt\[at]SOURCE.TXT
\f[R]
.fi
.PP
If a remote upstream file system stops responding, the current file
access is blocked (Unless the options \f[V]WITH_ASYNC_READDIR\f[R] \&...
are activated).
After some time, unresponsive upstream file trees will be skipped to
prevent that file accesses get blocked.
.SS ZIPsFS expands ZIP file entries
.PP
By default, ZIP files are displayed as folders with the suffix
\f[V].Content\f[R].
This behavior can be customized.
The default configuration includes a few exceptions tailored to specific
use cases in Mass Spectrometry:
.IP \[bu] 2
For ZIP files whose names end with \f[I].d.Zip\f[R], the virtual folder
will end with \f[I].d\f[R].
.IP \[bu] 2
Flat file list: For Sciex instruments, each mass spectrometry record is
stored in a set of files which are not organized in sub-folders.
For example the record
\f[V]20231122_MA_HEK_QC_hiFlow_2ug_SWATH_rep01\f[R] stored in
\f[V]20231122_MA_HEK_QC_hiFlow_2ug_SWATH_rep01.wiff2.Zip\f[R] may
consist of the following files
.RS 2
.IP \[bu] 2
20231122_MA_HEK_QC_hiFlow_2ug_SWATH_rep01.timeseries.data
.IP \[bu] 2
20231122_MA_HEK_QC_hiFlow_2ug_SWATH_rep01.wiff
.IP \[bu] 2
20231122_MA_HEK_QC_hiFlow_2ug_SWATH_rep01.wiff2
.IP \[bu] 2
20231122_MA_HEK_QC_hiFlow_2ug_SWATH_rep01.wiff.scan
.PP
These are contained with those of other entries in the file listing.
To get the full list of files, all ZIP files need to be inspected.
This is time consuming and performed in the background.
Consequently, the file listing will be incomplete when requested for the
first time.
Only after some seconds, the file listing will be presented properly.
.RE
.SS ZIPsFS Options
.PP
\f[B]-h\f[R]
.PP
Prints brief usage information.
.PP
\f[B]-s \f[BI]path-of-symbolic-link\f[B]\f[R] This is discussed in
section Configuration.
.PP
\f[B]-c [NEVER,SEEK,RULE,COMPRESSED,ALWAYS]\f[R]
.PP
Policy when ZIP entries and file content is cached in RAM.
.PP
.TS
tab(@);
cw(7.9n) lw(62.1n).
T{
NEVER
T}@T{
ZIP entries are never cached, even not in case of backward seek.
T}
T{
T}@T{
T}
T{
SEEK
T}@T{
ZIP entries are cached when the file position jumps backward.
T}
T{
T}@T{
T}
T{
RULE
T}@T{
ZIP entries are cached according to customizable rules or on backward
seed.
(DEFAULT)
T}
T{
T}@T{
T}
T{
COMPRESSED
T}@T{
All compressed ZIP entries are cached.
T}
T{
T}@T{
T}
T{
ALWAYS
T}@T{
All ZIP entries are cached.
T}
T{
T}@T{
T}
.TE
.PP
\f[B]-l \f[BI]Maximum memory for caching ZIP-entries in the
RAM\f[B]\f[R]
.PP
Specifies a limit for the cache.
For example \f[I]-l 8G\f[R] would limit the size of the cache to 8
Gigabyte.
File content larger than this will not be cached.
When memory usage is high, cached file access waits until it drops below
this value.
.PP
\f[B]-b\f[R] Execution in background (Not recommended).
We recommend running ZIPsFS in foreground in \f[I]tmux\f[R].
.SS FUSE Options
.PP
Options for the FUSE system come after the \f[B]colon\f[R] in the
command line.
.PP
\f[B]-o \f[BI]comma separated Options\f[B]\f[R]
.PP
\f[B]-o allow_other\f[R] Other users are granted access.
Project status
.PP
Author: Christoph Gille
.PP
\f[B]Current status\f[R]: Testing and Bug fixing.
Already running very busy for several weeks without interruption.
.PP
If ZIPsFS crashes, please send the stack-trace together with the source
code you were using.
